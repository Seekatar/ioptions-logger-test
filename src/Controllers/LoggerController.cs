/*
 * IConfiguration and IOption test
 *
 * Test API to show using IOptions and IConfiguration
 *
 * OpenAPI spec version: 1.0.0-oas3
 * Contact: myemail@bogus.com
 * Generated by: https://github.com/swagger-api/swagger-codegen.git
 */
using Microsoft.AspNetCore.Mvc;
using Swashbuckle.AspNetCore.Annotations;
using IOptionTest.Models;
using IOptionTest.Attributes;
using System.Diagnostics;
using Microsoft.Extensions.Logging.Abstractions;
using System.ComponentModel.DataAnnotations;

namespace IOptionTest.Controllers
{
    /// <summary>
    ///
    /// </summary>
    [ApiController]
    public partial class LoggerController : ControllerBase
    {
        private ILogger<LoggerController> _logger;
        static string EyeCatcher = "OOOOOOOOOOOOOOOOOOO";

        [LoggerMessage(0, LogLevel.Information, "This is to say: {Message}")]
        partial void LogMessage(string message);

        public LoggerController(ILogger<LoggerController> logger)
        {
            _logger = logger;
        }

        /// <summary>
        /// Log a message
        /// </summary>
        /// <param name="message">Message to log</param>
        /// <response code="200">Ok</response>
        /// <response code="400">bad input parameter</response>
        [HttpPost]
        [Route("/api/logger")]
        [ValidateModelState]
        [SwaggerOperation("LogMessage")]
        public virtual IActionResult LogMessage([FromBody]Message message)
        {
            _logger.Log(message.Level, "{eyeCatcher} Logging with {level} and message {message}",
                                            EyeCatcher, message.Level, message._Message);
            return Ok();
        }

        /// <summary>
        /// Log messages with LoggerMessage and LogInformation
        /// </summary>
        /// <param name="body">Message to log</param>
        /// <param name="logCount"></param>
        /// <response code="200">Ok</response>
        /// <response code="400">bad input parameter</response>
        [HttpPost]
        [Route("/api/logger/{logCount:int}")]
        [ValidateModelState]
        [SwaggerOperation("LogMessageCount")]
        [SwaggerResponse(statusCode: 200, type: typeof(Timings), description: "Ok")]
        public virtual ActionResult<Timings> LogMessageCount([FromBody] Message message, [FromRoute][Required] int logCount)
        {
            _logger = NullLogger<LoggerController>.Instance;

            var sw = Stopwatch.StartNew();
            for (int i = 0; i < logCount; i++)
                _logger.Log(message.Level, "This is to say: {Message}", message._Message);
            sw.Stop();

            var timing = new Timings { LogMs = sw.ElapsedMilliseconds };
            sw.Restart();
            for (int i = 0; i < logCount; i++)
                LogMessage(message._Message);
            sw.Stop();
            timing.LoggerMs = sw.ElapsedMilliseconds;

            return Ok(timing);
        }
    }
}
